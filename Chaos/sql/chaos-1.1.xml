<databaseChangeLog
		xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
		xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">

    <changeSet id="1" author="althar">
        <sql>
            CREATE TABLE public.book (
            id SERIAL NOT NULL,
            name VARCHAR NOT NULL,
            author VARCHAR,
            type VARCHAR DEFAULT 'Профессиональная литература' NOT NULL,
            genre VARCHAR DEFAULT '' NOT NULL,
            keywords VARCHAR,
            created TIMESTAMP WITHOUT TIME ZONE DEFAULT now() NOT NULL,
            user_id BIGINT,
            book_path VARCHAR,
            PRIMARY KEY(id)
            ) WITHOUT OIDS;
        </sql>
    </changeSet>
    <changeSet id="2" author="althar">
        <sql>
            CREATE TABLE public.chapter (
            id SERIAL NOT NULL,
            name VARCHAR NOT NULL,
            book_name VARCHAR NOT NULL,
            author VARCHAR,
            keywords VARCHAR,
            created TIMESTAMP WITHOUT TIME ZONE DEFAULT now() NOT NULL,
            user_id BIGINT,
            book_id BIGINT NOT NULL,
            PRIMARY KEY(id)
            ) WITHOUT OIDS;
        </sql>
    </changeSet>
    <changeSet id="3" author="althar">
        <sql>
            CREATE TABLE public.fragment (
            id SERIAL NOT NULL,
            created TIMESTAMP WITHOUT TIME ZONE DEFAULT now() NOT NULL,
            chapter_id BIGINT NOT NULL,
            text TEXT NOT NULL,
            PRIMARY KEY(id)
            ) WITHOUT OIDS;
        </sql>
    </changeSet>
    <changeSet id="4" author="althar">
        <sql>
            CREATE TABLE public.browsing_log (
            id SERIAL NOT NULL,
            created TIMESTAMP WITHOUT TIME ZONE DEFAULT now() NOT NULL,
            tracking_id BIGINT NOT NULL,
            page VARCHAR NOT NULL,
            ip VARCHAR,
            referer VARCHAR,
            PRIMARY KEY(id)
            ) WITHOUT OIDS;
        </sql>
    </changeSet>
    <changeSet id="5" author="althar">
        <sql>
            CREATE TABLE public.relation (
            id SERIAL NOT NULL,
            book_id BIGINT,
            chapter_id BIGINT,
            fragment_id BIGINT,
            relation_target VARCHAR DEFAULT 'FRAGMENT' NOT NULL,
            keyword VARCHAR,
            value INTEGER DEFAULT 0 NOT NULL,
            PRIMARY KEY(id)
            ) WITHOUT OIDS;
        </sql>
    </changeSet>
    <changeSet id="6" author="althar">
        <sql>
            CREATE TABLE public.image (
            id BIGSERIAL NOT NULL,
            unescaped_url VARCHAR NOT NULL,
            content_no_formatting VARCHAR NOT NULL,
            title_no_formatting VARCHAR NOT NULL,
            tb_url VARCHAR NOT NULL,
            width INTEGER DEFAULT 100 NOT NULL,
            height INTEGER DEFAULT 100 NOT NULL,
            keyword VARCHAR NOT NULL,
            downloaded BOOLEAN DEFAULT FALSE NOT NULL,
            PRIMARY KEY(id)
            ) WITHOUT OIDS;

            ALTER TABLE public.image
            ALTER COLUMN id SET STATISTICS 0;

            ALTER TABLE public.image
            ALTER COLUMN unescaped_url SET STATISTICS 0;

            ALTER TABLE public.image
            ALTER COLUMN content_no_formatting SET STATISTICS 0;

            ALTER TABLE public.image
            ALTER COLUMN title_no_formatting SET STATISTICS 0;

            ALTER TABLE public.image
            ALTER COLUMN tb_url SET STATISTICS 0;

            ALTER TABLE public.image
            ALTER COLUMN width SET STATISTICS 0;

            ALTER TABLE public.image
            ALTER COLUMN height SET STATISTICS 0;

            ALTER TABLE public.image
            ALTER COLUMN keyword SET STATISTICS 0;

            ALTER TABLE public.image
            ALTER COLUMN downloaded SET STATISTICS 0;
        </sql>
    </changeSet>
</databaseChangeLog>

